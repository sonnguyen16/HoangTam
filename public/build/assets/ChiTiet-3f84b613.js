import{Q as U,h as k,T as I,z as L,o as i,c,a as t,e as m,w as r,f as p,u as l,B as w,F as g,k as b,l as f,t as h,n as E,b as F,x as A,y as D,O as N}from"./app-5cd23246.js";import{T as O}from"./TreeItem-b85e04dc.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const o=_=>(A("data-v-4ac2b475"),_=_(),D(),_),H={id:"chitietdamodal",class:"modal fade",tabindex:"-1",style:{"z-index":"1051"},role:"dialog"},K={class:"modal-dialog modal-xl",role:"document"},Q={class:"modal-content"},q={class:"modal-header"},G=o(()=>t("i",{class:"fa fa-times text-lg"},null,-1)),J=[G],P={class:"modal-body"},R={class:"d-flex align-items-center"},W=o(()=>t("label",{for:"ngay_bat_dau",class:"font-weight-bold text-secondary mt-2"},"Bắt đầu:",-1)),X=o(()=>t("label",{for:"ngay_ket_thuc",class:"font-weight-bold text-secondary mt-2"},"Kết thúc:",-1)),Y=o(()=>t("label",{class:"font-weight-bold text-secondary mt-2"},"Tình trạng",-1)),Z=o(()=>t("option",{value:"0"},"Chưa thực hiện",-1)),tt=o(()=>t("option",{value:"1"},"Đang thực hiện",-1)),et=o(()=>t("option",{value:"2"},"Đã hoàn thành",-1)),st=[Z,tt,et],nt=o(()=>t("label",{for:"user",class:"font-weight-bold text-secondary mt-2"},"Người thực hiện:",-1)),ot=["value"],at={class:"mt-3"},lt=o(()=>t("label",{for:"mo_ta",class:"font-weight-bold text-success"},"Mô tả hạng mục:",-1)),dt={class:"mt-3"},it={class:"d-flex align-items-center mb-2"},ct=o(()=>t("label",{for:"mo_ta",class:"font-weight-bold text-success mt-2"},"Attachments:",-1)),_t=o(()=>t("label",{for:"files1",class:"btn btn-success btn-sm mt-2 ml-3"},"Chọn file",-1)),rt=o(()=>t("span",{id:"fileList",class:"d-inline-block ml-3"},null,-1)),ut={key:0,class:"row"},ht={class:"col-md-4"},mt={class:"card"},pt={class:"card-body p-0"},gt={class:"table table-striped"},bt=o(()=>t("thead",null,[t("tr",null,[t("th",null,"File"),t("th",null,"Actions")])],-1)),ft={class:"d-flex gap-[5px] justify-content-center"},vt=["href"],yt=["onClick"],xt=["disabled"],kt=o(()=>t("hr",null,null,-1)),wt={class:"mt-4 mb-4",id:"subtasks"},Ct=o(()=>t("label",{for:"mo_ta",class:"font-weight-bold text-success"},"Hạng mục con:",-1)),jt={class:"mt-3 container"},Vt=o(()=>t("hr",null,null,-1)),Bt={id:"comments",class:"mt-4"},St={class:"font-weight-bold"},Tt={class:"card"},$t={class:"card-body"},Mt=["src"],Ut={key:1,src:"/uploads/avatardefault.png",alt:"avatar",class:"rounded-full w-10 object-cover"},It=["value"],Lt=o(()=>t("input",{id:"comment",class:"form-control border-0 flex-1",placeholder:"Nhập bình luận"},null,-1)),Et=o(()=>t("button",{type:"submit",class:""},[t("i",{class:"fa fa-paper-plane text-lg text-primary"})],-1)),Ft={class:""},At={class:"d-flex"},Dt=["src"],Nt={key:1,src:"/uploads/avatardefault.png",alt:"avatar",class:"rounded-full w-10 h-10 object-cover"},Ot={class:"flex-1 ml-3"},zt={class:"d-flex justify-content-between"},Ht={class:"font-weight-bold"},Kt={class:"text-secondary"},Qt={class:"text-md"},qt=o(()=>t("div",{class:"modal-footer"},null,-1)),Gt={__name:"ChiTiet",props:{du_an:Object,users:Object},emits:["edit","add"],setup(_,{emit:C}){const v=U(),a=_,u=k([]),s=I({id:"",ten:"",ngay_bat_dau:"",ngay_ket_thuc:"",user_id:"",mo_ta:"",trang_thai:"",parent_id:"",children:[],files:[]});L(()=>{s.id=a.du_an.id,s.ten=a.du_an.ten,s.ngay_bat_dau=a.du_an.ngay_bat_dau,s.ngay_ket_thuc=a.du_an.ngay_ket_thuc,s.user_id=a.du_an.user_id,$("#user").val(a.du_an.user_id).trigger("change"),s.mo_ta=a.du_an.mo_ta,s.trang_thai=a.du_an.trang_thai,s.parent_id=a.du_an.parent_id,s.children=a.du_an.children,s.files=a.du_an.files,u.value=a.du_an.files});const j=()=>{s.post(route("duan.store"),{onSuccess:()=>{toastr.success("Cập nhật thành công")},onError:()=>{toastr.error("Có lỗi xảy ra, vui lòng thử lại")}})},V=()=>{$("#files1").val(""),$("#chitietdamodal").modal("hide"),s.reset(),s.clearErrors(),N.reload()},B=d=>{confirm("Bạn có chắc chắn muốn xóa file này không?")&&(s.files=s.files.filter(n=>n.id!==d),u.value=u.value.filter(n=>n.id!==d),axios({method:"delete",url:route("duan.file.delete",{id:d})}))};function S(d){s.files=d.target.files,u.value=[...u.value,...Array.from(d.target.files).map(n=>({ten:n.name}))]}k({id:"",ten:"",ngay_bat_dau:"",ngay_ket_thuc:"",user_id:"",nhan_vien:{},mo_ta:"",trang_thai:"",parent_id:"",children:[],files:[]});const y=C,T=d=>{y("edit",d)},x=d=>{y("add",d)};function M(){axios({method:"post",url:route("binhluan.store"),data:{noi_dung:$("#comment").val(),du_an_id:a.du_an.id}}).then(d=>{$("#comment").val(""),a.du_an.binh_luan.push({noi_dung:d.data.noi_dung,nguoi_dung:d.data.nguoi_dung,created_at:d.data.created_at})}).catch(d=>{console.log(d)})}return(d,n)=>(i(),c("div",H,[t("div",K,[t("div",Q,[t("div",q,[t("button",{type:"button",class:"close",onClick:m(V,["prevent"])},J)]),t("form",{onSubmit:m(j,["prevent"])},[t("div",P,[r(t("input",{type:"hidden","onUpdate:modelValue":n[0]||(n[0]=e=>l(s).id=e),id:"id",class:"form-control"},null,512),[[p,l(s).id]]),r(t("input",{type:"text",class:"font-weight-bold border-0 text-lg pl-0","onUpdate:modelValue":n[1]||(n[1]=e=>l(s).ten=e)},null,512),[[p,l(s).ten]]),t("div",R,[W,r(t("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=e=>l(s).ngay_bat_dau=e),id:"ngay_bat_dau",class:"border-0 mr-5 text-secondary"},null,512),[[p,l(s).ngay_bat_dau]]),X,r(t("input",{type:"date","onUpdate:modelValue":n[3]||(n[3]=e=>l(s).ngay_ket_thuc=e),id:"ngay_ket_thuc",class:"border-0 mr-5 text-secondary"},null,512),[[p,l(s).ngay_ket_thuc]]),Y,r(t("select",{"onUpdate:modelValue":n[4]||(n[4]=e=>l(s).trang_thai=e),class:"border-0 active:outline-0 outline-0 focus:outline-0 mr-5 font-bold",id:"trang_thai"},st,512),[[w,l(s).trang_thai]]),nt,r(t("select",{"onUpdate:modelValue":n[5]||(n[5]=e=>l(s).user_id=e),class:"border-0 outline-0 font-bold focus:outline-0",id:"user"},[(i(!0),c(g,null,b(_.users,e=>(i(),c("option",{value:e.id},h(e.name),9,ot))),256))],512),[[w,l(s).user_id]])]),t("div",at,[lt,r(t("textarea",{"onUpdate:modelValue":n[6]||(n[6]=e=>l(s).mo_ta=e),id:"mo_ta",class:"form-control border-0 pl-0",rows:"3"},null,512),[[p,l(s).mo_ta]])]),t("div",dt,[t("div",it,[ct,_t,t("input",{accept:".png, .jpg, .jpeg, .gif, .bmp, .doc, .docx, .xls, .xlsx, .pdf",type:"file",onInput:n[7]||(n[7]=e=>S(e)),id:"files1",class:"d-none",multiple:""},null,32),rt]),l(s).files.length>0?(i(),c("div",ut,[t("div",ht,[t("div",mt,[t("div",pt,[t("table",gt,[bt,t("tbody",null,[(i(!0),c(g,null,b(u.value,e=>(i(),c("tr",{key:e.id},[t("td",null,h(e.ten.length>30?e.ten.slice(0,30)+"...":e.ten),1),t("td",ft,[e.id?(i(),c("a",{key:0,href:`/uploads/${e.ten}`,target:"_blank",class:"btn btn-primary btn-sm"},"View",8,vt)):f("",!0),e.id?(i(),c("a",{key:1,onClick:m(Jt=>B(e.id),["prevent"]),class:"btn btn-sm btn-danger"},"Delete",8,yt)):f("",!0)])]))),128))])])])])])])):f("",!0),t("button",{type:"submit",disabled:l(s).processing,class:"btn btn-primary right-0"},"Lưu",8,xt),kt,t("div",wt,[Ct,t("a",{class:"btn btn-primary btn-sm ml-3 font-weight-bold",onClick:n[8]||(n[8]=m(e=>x(_.du_an.id),["prevent"]))},"Thêm"),t("div",jt,[(i(!0),c(g,null,b(_.du_an.children,e=>(i(),F(O,{class:"",key:e.id,item:e,onEdit:T,onAdd:x},null,8,["item"]))),128))])]),Vt,t("div",Bt,[t("p",St,"Bình luận ("+h(a.du_an.binh_luan.length)+")",1),t("div",Tt,[t("div",$t,[t("div",{class:E(["d-flex",{"mb-4":a.du_an.binh_luan.length>0}])},[l(v).props.user.hinh_anh?(i(),c("img",{key:0,src:"/uploads/nhan_vien/"+l(v).props.user.hinh_anh,alt:"avatar",class:"rounded-full w-10 h-10 object-cover"},null,8,Mt)):(i(),c("img",Ut)),t("form",{onSubmit:n[9]||(n[9]=m(e=>M(),["prevent"])),class:"flex-1 d-flex"},[t("input",{type:"hidden",value:a.du_an.id},null,8,It),Lt,Et],32)],2),(i(!0),c(g,null,b(a.du_an.binh_luan,e=>(i(),c("div",Ft,[t("div",At,[e.nguoi_dung.hinh_anh?(i(),c("img",{key:0,src:"/uploads/nhan_vien/"+e.nguoi_dung.hinh_anh,alt:"avatar",class:"rounded-full w-10 h-10 object-cover"},null,8,Dt)):(i(),c("img",Nt)),t("div",Ot,[t("div",zt,[t("span",Ht,h(e.nguoi_dung.name),1),t("span",Kt,h(new Date(e.created_at).toLocaleString()),1)]),t("p",Qt,h(e.noi_dung),1)])])]))),256))])])])])]),qt],32)])])]))}},Xt=z(Gt,[["__scopeId","data-v-4ac2b475"]]);export{Xt as default};
