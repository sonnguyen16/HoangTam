import{h as j,E as D,o as a,c as o,a as t,n as C,D as V,l as f,e as m,u as i,m as F,t as _,F as x,k,b as E,x as L,y as M,Q as z,T as H,z as K,w as b,f as y,B,O as Q}from"./app-451a1b70.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";const N=s=>(L("data-v-7457ba01"),s=s(),M(),s),q={class:"row mb-3"},G={key:0,class:"vertical-line"},J={class:"col-lg-2 d-lg-block d-none"},P={class:"col-lg-2 d-lg-block d-none"},R={class:"col-lg-2 d-lg-block d-none"},W={key:0,class:"badge badge-warning"},X={key:1,class:"badge badge-primary"},Y={key:2,class:"badge badge-success"},Z={class:"col-lg-2 d-lg-block d-none"},tt={class:"col-lg-1 col-3"},et=N(()=>t("i",{class:"fa fa-plus text-neutral-500 mr-3"},null,-1)),nt=[et],st=N(()=>t("i",{class:"fa fa-edit text-neutral-500"},null,-1)),lt=[st],at={__name:"TreeItem",props:{item:Object,isChild:{type:Boolean,default:!1},level:{type:Number,default:0}},emits:["edit","add"],setup(s,{emit:T}){let g=j(!0);const d=T;function h(){g.value=!g.value}return(n,r)=>{var w;const I=D("TreeItem",!0);return a(),o("div",null,[t("div",q,[t("div",{class:C(["col-lg-3 col-9",{"child-container":s.isChild}]),style:V({paddingLeft:`${s.level*15}px`})},[t("span",{style:V({width:`${s.level*15}px`}),class:"line-connector"},null,4),s.isChild?(a(),o("span",G)):f("",!0),t("a",{onClick:m(h,["prevent"]),class:C([s.item.children?"cursor-pointer":"cursor-text","mb-2 text-black"])},[s.item.children?(a(),o("i",{key:0,class:C(["fa fa-folder mr-2 text-amber-400 text-lg",i(g)?"fa-folder-open":"fa-folder-closed"])},null,2)):f("",!0),F(" "+_(s.item.ten),1)],2)],6),t("div",J,[t("span",null,_(s.item.ngay_bat_dau),1)]),t("div",P,[t("span",null,_(s.item.ngay_ket_thuc),1)]),t("div",R,[t("span",null,[s.item.trang_thai==0?(a(),o("span",W,"Chưa thực hiện")):s.item.trang_thai==1?(a(),o("span",X,"Đang thực hiện")):s.item.trang_thai==2?(a(),o("span",Y,"Đã hoàn thành")):f("",!0)])]),t("div",Z,[t("span",null,_((w=s.item.nhan_vien)==null?void 0:w.name),1)]),t("div",tt,[t("a",{onClick:r[0]||(r[0]=m(v=>{d("add",s.item.id)},["prevent"]))},nt),t("a",{onClick:r[1]||(r[1]=m(v=>{d("edit",s.item)},["prevent"]))},lt)])]),t("div",null,[i(g)?(a(!0),o(x,{key:0},k(s.item.children,v=>(a(),E(I,{"is-child":!0,level:s.level+1,key:v.id,item:v,onEdit:r[2]||(r[2]=p=>n.$emit("edit",p)),onAdd:r[3]||(r[3]=p=>n.$emit("add",p))},null,8,["level","item"]))),128)):f("",!0)])])}}},ot=U(at,[["__scopeId","data-v-7457ba01"]]);const c=s=>(L("data-v-011640fe"),s=s(),M(),s),dt={id:"chitietdamodal",class:"modal fade",tabindex:"-1",style:{"z-index":"1051"},role:"dialog"},it={class:"modal-dialog modal-xl",role:"document"},ct={class:"modal-content"},ut={class:"modal-header"},rt=c(()=>t("i",{class:"fa fa-times text-lg"},null,-1)),_t=[rt],ht={class:"modal-body"},mt={class:"d-flex align-items-center"},gt=c(()=>t("label",{for:"ngay_bat_dau",class:"font-weight-bold text-secondary mt-2"},"Bắt đầu:",-1)),bt=c(()=>t("label",{for:"ngay_ket_thuc",class:"font-weight-bold text-secondary mt-2"},"Kết thúc:",-1)),ft=c(()=>t("label",{class:"font-weight-bold text-secondary mt-2"},"Tình trạng",-1)),vt=c(()=>t("option",{value:"0"},"Chưa thực hiện",-1)),pt=c(()=>t("option",{value:"1"},"Đang thực hiện",-1)),yt=c(()=>t("option",{value:"2"},"Đã hoàn thành",-1)),xt=[vt,pt,yt],kt=c(()=>t("label",{for:"user",class:"font-weight-bold text-secondary mt-2"},"Người thực hiện:",-1)),$t=["value"],wt={class:"mt-3"},Ct=c(()=>t("label",{for:"mo_ta",class:"font-weight-bold text-success"},"Mô tả hạng mục:",-1)),Tt={class:"mt-3"},It={class:"d-flex align-items-center mb-2"},jt=c(()=>t("label",{for:"mo_ta",class:"font-weight-bold text-success mt-2"},"Attachments:",-1)),St=c(()=>t("label",{for:"files1",class:"btn btn-success btn-sm mt-2 ml-3"},"Chọn file",-1)),Vt=c(()=>t("span",{id:"fileList",class:"d-inline-block ml-3"},null,-1)),Bt={key:0,class:"row"},Et={class:"col-md-4"},Lt={class:"card"},Mt={class:"card-body p-0"},Ut={class:"table table-striped"},Nt=c(()=>t("thead",null,[t("tr",null,[t("th",null,"File"),t("th",null,"Actions")])],-1)),Ot={class:"d-flex gap-[5px] justify-content-center"},At=["href"],Dt=["onClick"],Ft=["disabled"],zt=c(()=>t("hr",null,null,-1)),Ht={class:"mt-4 mb-4",id:"subtasks"},Kt=c(()=>t("label",{for:"mo_ta",class:"font-weight-bold text-success"},"Hạng mục con:",-1)),Qt={class:"mt-3 container"},qt=c(()=>t("hr",null,null,-1)),Gt={id:"comments",class:"mt-4"},Jt={class:"font-weight-bold"},Pt={class:"card"},Rt={class:"card-body"},Wt=["src"],Xt={key:1,src:"/uploads/avatardefault.png",alt:"avatar",class:"rounded-full w-10 object-cover"},Yt=["value"],Zt=c(()=>t("input",{id:"comment",class:"form-control border-0 flex-1",placeholder:"Nhập bình luận"},null,-1)),te=c(()=>t("button",{type:"submit",class:""},[t("i",{class:"fa fa-paper-plane text-lg text-primary"})],-1)),ee={class:""},ne={class:"d-flex"},se=["src"],le={key:1,src:"/uploads/avatardefault.png",alt:"avatar",class:"rounded-full w-10 h-10 object-cover"},ae={class:"flex-1 ml-3"},oe={class:"d-flex justify-content-between"},de={class:"font-weight-bold"},ie={class:"text-secondary"},ce={class:"text-md"},ue=c(()=>t("div",{class:"modal-footer"},null,-1)),re={__name:"ChiTiet",props:{du_an:Object,users:Object},emits:["edit","add"],setup(s,{emit:T}){const g=z(),d=s,h=j([]),n=H({id:"",ten:"",ngay_bat_dau:"",ngay_ket_thuc:"",user_id:"",mo_ta:"",trang_thai:"",parent_id:"",children:[],files:[]});K(()=>{n.id=d.du_an.id,n.ten=d.du_an.ten,n.ngay_bat_dau=d.du_an.ngay_bat_dau,n.ngay_ket_thuc=d.du_an.ngay_ket_thuc,n.user_id=d.du_an.user_id,$("#user").val(d.du_an.user_id).trigger("change"),n.mo_ta=d.du_an.mo_ta,n.trang_thai=d.du_an.trang_thai,n.parent_id=d.du_an.parent_id,n.children=d.du_an.children,n.files=d.du_an.files,h.value=d.du_an.files});const r=()=>{n.post(route("duan.store"),{onSuccess:()=>{toastr.success("Cập nhật thành công")},onError:()=>{toastr.error("Có lỗi xảy ra, vui lòng thử lại")}})},I=()=>{$("#files1").val(""),$("#chitietdamodal").modal("hide"),n.reset(),n.clearErrors(),Q.reload()},w=u=>{confirm("Bạn có chắc chắn muốn xóa file này không?")&&(n.files=n.files.filter(l=>l.id!==u),h.value=h.value.filter(l=>l.id!==u),axios({method:"delete",url:route("duan.file.delete",{id:u})}))};function v(u){n.files=u.target.files,h.value=[...h.value,...Array.from(u.target.files).map(l=>({ten:l.name}))]}j({id:"",ten:"",ngay_bat_dau:"",ngay_ket_thuc:"",user_id:"",nhan_vien:{},mo_ta:"",trang_thai:"",parent_id:"",children:[],files:[]});const p=T,O=u=>{p("edit",u)},S=u=>{p("add",u)};function A(){axios({method:"post",url:route("binhluan.store"),data:{noi_dung:$("#comment").val(),du_an_id:d.du_an.id}}).then(u=>{$("#comment").val(""),d.du_an.binh_luan.push({noi_dung:u.data.noi_dung,nguoi_dung:u.data.nguoi_dung,created_at:u.data.created_at})}).catch(u=>{console.log(u)})}return(u,l)=>(a(),o("div",dt,[t("div",it,[t("div",ct,[t("div",ut,[t("button",{type:"button",class:"close",onClick:m(I,["prevent"])},_t)]),t("form",{onSubmit:m(r,["prevent"])},[t("div",ht,[b(t("input",{type:"hidden","onUpdate:modelValue":l[0]||(l[0]=e=>i(n).id=e),id:"id",class:"form-control"},null,512),[[y,i(n).id]]),b(t("input",{type:"text",class:"font-weight-bold border-0 text-lg pl-0","onUpdate:modelValue":l[1]||(l[1]=e=>i(n).ten=e)},null,512),[[y,i(n).ten]]),t("div",mt,[gt,b(t("input",{type:"date","onUpdate:modelValue":l[2]||(l[2]=e=>i(n).ngay_bat_dau=e),id:"ngay_bat_dau",class:"border-0 mr-5 text-secondary"},null,512),[[y,i(n).ngay_bat_dau]]),bt,b(t("input",{type:"date","onUpdate:modelValue":l[3]||(l[3]=e=>i(n).ngay_ket_thuc=e),id:"ngay_ket_thuc",class:"border-0 mr-5 text-secondary"},null,512),[[y,i(n).ngay_ket_thuc]]),ft,b(t("select",{"onUpdate:modelValue":l[4]||(l[4]=e=>i(n).trang_thai=e),class:"border-0 active:outline-0 outline-0 focus:outline-0 mr-5 font-bold",id:"trang_thai"},xt,512),[[B,i(n).trang_thai]]),kt,b(t("select",{"onUpdate:modelValue":l[5]||(l[5]=e=>i(n).user_id=e),class:"border-0 outline-0 font-bold focus:outline-0",id:"user"},[(a(!0),o(x,null,k(s.users,e=>(a(),o("option",{value:e.id},_(e.name),9,$t))),256))],512),[[B,i(n).user_id]])]),t("div",wt,[Ct,b(t("textarea",{"onUpdate:modelValue":l[6]||(l[6]=e=>i(n).mo_ta=e),id:"mo_ta",class:"form-control border-0 pl-0",rows:"3"},null,512),[[y,i(n).mo_ta]])]),t("div",Tt,[t("div",It,[jt,St,t("input",{accept:".png, .jpg, .jpeg, .gif, .bmp, .doc, .docx, .xls, .xlsx, .pdf",type:"file",onInput:l[7]||(l[7]=e=>v(e)),id:"files1",class:"d-none",multiple:""},null,32),Vt]),h.value.length>0?(a(),o("div",Bt,[t("div",Et,[t("div",Lt,[t("div",Mt,[t("table",Ut,[Nt,t("tbody",null,[(a(!0),o(x,null,k(h.value,e=>(a(),o("tr",{key:e.id},[t("td",null,_(e.ten.length>30?e.ten.slice(0,30)+"...":e.ten),1),t("td",Ot,[e.id?(a(),o("a",{key:0,href:`/uploads/du_an/${e.ten}`,target:"_blank",class:"btn btn-primary btn-sm"},"View",8,At)):f("",!0),e.id?(a(),o("a",{key:1,onClick:m(_e=>w(e.id),["prevent"]),class:"btn btn-sm btn-danger"},"Delete",8,Dt)):f("",!0)])]))),128))])])])])])])):f("",!0),t("button",{type:"submit",disabled:i(n).processing,class:"btn btn-primary right-0"},"Lưu",8,Ft),zt,t("div",Ht,[Kt,t("a",{class:"btn btn-primary btn-sm ml-3 font-weight-bold",onClick:l[8]||(l[8]=m(e=>S(s.du_an.id),["prevent"]))},"Thêm"),t("div",Qt,[(a(!0),o(x,null,k(s.du_an.children,e=>(a(),E(ot,{class:"",key:e.id,item:e,onEdit:O,onAdd:S},null,8,["item"]))),128))])]),qt,t("div",Gt,[t("p",Jt,"Bình luận ("+_(d.du_an.binh_luan.length)+")",1),t("div",Pt,[t("div",Rt,[t("div",{class:C(["d-flex",{"mb-4":d.du_an.binh_luan.length>0}])},[i(g).props.user.hinh_anh?(a(),o("img",{key:0,src:"/uploads/nhan_vien/"+i(g).props.user.hinh_anh,alt:"avatar",class:"rounded-full w-10 h-10 object-cover"},null,8,Wt)):(a(),o("img",Xt)),t("form",{onSubmit:l[9]||(l[9]=m(e=>A(),["prevent"])),class:"flex-1 d-flex"},[t("input",{type:"hidden",value:d.du_an.id},null,8,Yt),Zt,te],32)],2),(a(!0),o(x,null,k(d.du_an.binh_luan,e=>(a(),o("div",ee,[t("div",ne,[e.nguoi_dung.hinh_anh?(a(),o("img",{key:0,src:"/uploads/nhan_vien/"+e.nguoi_dung.hinh_anh,alt:"avatar",class:"rounded-full w-10 h-10 object-cover"},null,8,se)):(a(),o("img",le)),t("div",ae,[t("div",oe,[t("span",de,_(e.nguoi_dung.name),1),t("span",ie,_(new Date(e.created_at).toLocaleString()),1)]),t("p",ce,_(e.noi_dung),1)])])]))),256))])])])])]),ue],32)])])]))}},ge=U(re,[["__scopeId","data-v-011640fe"]]);export{ge as default};
