import{T,h as U,z as E,q as O,A as I,o as d,c as _,a as o,e as m,w as r,f as u,u as s,n as p,B as C,F as f,k as v,t as c,x as Y,y as j,O as q}from"./app-843415b2.js";import{l as M}from"./lodash-1fdda582.js";import{h as z}from"./moment-a9aaa855.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";const i=h=>(Y("data-v-1eccf44c"),h=h(),j(),h),H={id:"donhangmodal",class:"modal fade",role:"dialog"},K={class:"modal-dialog modal-xl",role:"document"},L={class:"modal-content"},N={class:"modal-header"},A={class:"modal-body"},G={class:"form-group-container"},J={class:"form-group-title"},P={key:0,class:"txt-color mb-0 font-weight-bold"},Q={key:1,class:"txt-color mb-0 font-weight-bold"},R={class:"form-group"},W=i(()=>o("label",{for:"ma"},"Mã đơn",-1)),X={class:"form-group"},Z=i(()=>o("label",{for:"ngay"},"Ngày",-1)),oo={class:"form-group"},no=i(()=>o("label",{for:"name"},"Khách hàng",-1)),to=i(()=>o("option",{value:""},"Chọn khách hàng",-1)),so=["value"],ao={class:"form-group"},eo=i(()=>o("label",{for:"ghi_chu"},"Ghi chú",-1)),io={class:"form-group-container mt-4"},lo=i(()=>o("div",{class:"form-group-title"},[o("span",null,"Chi tiết đơn bán")],-1)),_o={class:"row mb-3"},ho={class:"col-4"},ro={class:"form-record"},co=i(()=>o("label",null,"Sản phẩm",-1)),go=["value"],uo={class:"col-3"},mo={class:"form-record"},po=i(()=>o("label",{for:"name"},"Số lượng",-1)),fo={class:"col-3"},vo={class:"form-record"},bo=i(()=>o("label",{for:"name"},"Đơn giá",-1)),yo={class:"col-2"},ko={class:"table table-bordered table-responsive-md"},So=i(()=>o("thead",null,[o("tr",null,[o("th",null,"Mã sản phẩm"),o("th",null,"Tên sản phẩm"),o("th",null,"Số lượng"),o("th",null,"ĐVT"),o("th",null,"Đơn giá"),o("th",null,"Thành tiền"),o("th")])],-1)),xo={key:0},Co=i(()=>o("td",{colspan:"7",class:"text-center"},"Không có dữ liệu",-1)),Mo=[Co],wo={class:"ma"},Do={class:"ten"},Vo={class:"quantity"},$o={class:"quantity"},Bo={class:"money"},To={class:"money"},Uo={class:"action"},Eo=["onClick"],Oo=i(()=>o("i",{class:"fas fa-trash"},null,-1)),Io=[Oo],Yo={class:"modal-footer"},jo=["disabled"],qo={__name:"DonBanModal",props:{don_hang:Object,khach_hang_list:Object,san_pham_list:Object},setup(h){const l=h,t=T({id:"",ma:"",ngay:"",khach_hang_id:"",ghi_chu:"",loai:1,chi_tiet_don_hang:[]});let e=U({id:"",don_hang_id:l.don_hang.id,san_pham:{},so_luong:1,gia:0});E(()=>{var g;t.id=l.don_hang.id||"",t.ma=l.don_hang.ma||"",t.ngay=l.don_hang.ngay||z().format("YYYY-MM-DD"),t.khach_hang_id=((g=l.don_hang.khach_hang)==null?void 0:g.id)||"",t.ghi_chu=l.don_hang.ghi_chu||"",t.chi_tiet_don_hang=l.don_hang.chi_tiet_don_hang||[]});const w=()=>{l.don_hang.id||(t.ma="DH"+Date.now().toString().slice(-6)),t.post(route("donhang.store"),{onSuccess:()=>{$("#donhangmodal").modal("hide"),q.visit(route("donhang.index",{loai:"donban"}))},onError:()=>{console.log(t.errors)}})},b=()=>{$("#donhangmodal").modal("hide"),t.reset(),t.chi_tiet_don_hang=[],t.clearErrors()};function D(g){t.chi_tiet_don_hang=t.chi_tiet_don_hang.filter((a,n)=>n!==g)}function V(){M.isEmpty(e.value.san_pham)||e.value.so_luong!==0&&(t.chi_tiet_don_hang.push({id:"",don_hang_id:l.don_hang.id,san_pham:M.cloneDeep(e.value.san_pham),so_luong:e.value.so_luong,gia:e.value.gia,thanh_tien:e.value.gia*e.value.so_luong}),e.value={id:"",don_hang_id:l.don_hang.id,san_pham:{},so_luong:0,gia:0},$("#sanpham").val(null).trigger("change"))}return O(()=>{$("#sanpham").select2({placeholder:"Chọn sản phẩm"}).on("change",function(){e.value.san_pham=l.san_pham_list.data.find(g=>String(g.id)===$(this).val())}),$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"}).on("change",function(){t.khach_hang_id=$(this).val()})}),I(()=>{$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"})}),(g,a)=>(d(),_("div",H,[o("div",K,[o("div",L,[o("div",N,[o("button",{type:"button",class:"close",onClick:m(b,["prevent"])},"×")]),o("form",{onSubmit:m(w,["prevent"])},[o("div",A,[r(o("input",{type:"hidden","onUpdate:modelValue":a[0]||(a[0]=n=>s(t).id=n),id:"id",class:"form-control"},null,512),[[u,s(t).id]]),o("div",G,[o("div",J,[h.don_hang.id?(d(),_("span",P,"Sửa đơn hàng")):(d(),_("span",Q,"Thêm đơn hàng"))]),o("div",R,[W,o("div",null,[r(o("input",{readonly:"",class:p([{"border-danger":s(t).errors.ma},"form-control"]),type:"text","onUpdate:modelValue":a[1]||(a[1]=n=>s(t).ma=n),id:"ma"},null,2),[[u,s(t).ma]])])]),o("div",X,[Z,o("div",null,[r(o("input",{class:p([{"border-danger":s(t).errors.ngay},"form-control"]),type:"date","onUpdate:modelValue":a[2]||(a[2]=n=>s(t).ngay=n),id:"ngay"},null,2),[[u,s(t).ngay]])])]),o("div",oo,[no,o("div",null,[r(o("select",{class:p([{"border-danger":s(t).errors.khach_hang_id},"form-control"]),"onUpdate:modelValue":a[3]||(a[3]=n=>s(t).khach_hang_id=n),id:"khach_hang_id"},[to,(d(!0),_(f,null,v(h.khach_hang_list,n=>(d(),_("option",{key:n.id,value:n.id},c(n.ten),9,so))),128))],2),[[C,s(t).khach_hang_id]])])]),o("div",ao,[eo,o("div",null,[r(o("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=n=>s(t).ghi_chu=n),class:"form-control",id:"ghi_chu"},null,512),[[u,s(t).ghi_chu]])])])]),o("div",io,[lo,o("div",_o,[o("div",ho,[o("div",ro,[co,r(o("select",{class:"form-control","onUpdate:modelValue":a[5]||(a[5]=n=>s(e).san_pham=n),id:"sanpham"},[(d(!0),_(f,null,v(h.san_pham_list.data,n=>(d(),_("option",{value:n.id},c(n.ten),9,go))),256))],512),[[C,s(e).san_pham]])])]),o("div",uo,[o("div",mo,[po,r(o("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=n=>s(e).so_luong=n),class:"form-control",id:"ghi_chu"},null,512),[[u,s(e).so_luong]])])]),o("div",fo,[o("div",vo,[bo,r(o("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=n=>s(e).gia=n),class:"form-control",id:"gia"},null,512),[[u,s(e).gia]])])]),o("div",yo,[o("button",{onClick:a[8]||(a[8]=m(n=>V(),["prevent"])),class:"btn btn-primary form-control"},"Thêm")])]),o("table",ko,[So,o("tbody",null,[s(t).chi_tiet_don_hang.length===0?(d(),_("tr",xo,Mo)):(d(!0),_(f,{key:1},v(s(t).chi_tiet_don_hang,(n,B)=>{var y,k,S,x;return d(),_("tr",{key:n.id},[o("td",wo,c((y=n==null?void 0:n.san_pham)==null?void 0:y.ma),1),o("td",Do,c((k=n==null?void 0:n.san_pham)==null?void 0:k.ten),1),o("td",Vo,c(n==null?void 0:n.so_luong),1),o("td",$o,c((x=(S=n==null?void 0:n.san_pham)==null?void 0:S.don_vi_tinh)==null?void 0:x.ten),1),o("td",Bo,c(n==null?void 0:n.gia.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",To,c(n==null?void 0:n.thanh_tien.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Uo,[o("a",{class:"btn btn-danger btn-sm",onClick:m(zo=>D(B),["prevent"])},Io,8,Eo)])])}),128))])])])]),o("div",Yo,[o("button",{type:"submit",disabled:s(t).processing,class:"btn btn-primary"},"Lưu",8,jo),o("button",{type:"button",class:"btn btn-default",onClick:m(b,["prevent"])},"Hủy")])],32)])])]))}},No=F(qo,[["__scopeId","data-v-1eccf44c"]]);export{No as default};
