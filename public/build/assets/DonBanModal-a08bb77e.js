import{T,h as U,z as E,q as I,A as Y,o as d,c as _,a as o,e as m,w as r,f as u,u as s,n as f,B as C,F as v,k as b,t as c,x as j,y as q}from"./app-a0d3c948.js";import{l as M}from"./lodash-70b814e4.js";import{h as O}from"./moment-a9aaa855.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const l=h=>(j("data-v-62fcf3bd"),h=h(),q(),h),F={id:"donhangmodal",class:"modal fade",role:"dialog"},H={class:"modal-dialog modal-xl",role:"document"},K={class:"modal-content"},L={class:"modal-header"},N={class:"modal-body"},A={class:"form-group-container"},G={class:"form-group-title"},J={key:0,class:"txt-color mb-0 font-weight-bold"},P={key:1,class:"txt-color mb-0 font-weight-bold"},Q={class:"form-group"},R=l(()=>o("label",{for:"ma"},"Mã đơn",-1)),W={class:"form-group"},X=l(()=>o("label",{for:"ngay"},"Ngày",-1)),Z={class:"form-group"},oo=l(()=>o("label",{for:"name"},"Khách hàng",-1)),no=l(()=>o("option",{value:""},"Chọn khách hàng",-1)),to=["value"],so={class:"form-group"},ao=l(()=>o("label",{for:"ghi_chu"},"Ghi chú",-1)),eo={class:"form-group-container mt-4"},lo=l(()=>o("div",{class:"form-group-title"},[o("span",null,"Chi tiết đơn bán")],-1)),io={class:"row mb-3"},_o={class:"col-4"},ho={class:"form-record"},ro=l(()=>o("label",null,"Sản phẩm",-1)),co=["value"],go={class:"col-3"},uo={class:"form-record"},mo=l(()=>o("label",{for:"name"},"Số lượng",-1)),po={class:"col-3"},fo={class:"form-record"},vo=l(()=>o("label",{for:"name"},"Đơn giá",-1)),bo={class:"col-2"},yo={class:"table table-bordered table-responsive-md"},ko=l(()=>o("thead",null,[o("tr",null,[o("th",null,"Mã sản phẩm"),o("th",null,"Tên sản phẩm"),o("th",null,"Số lượng"),o("th",null,"ĐVT"),o("th",null,"Đơn giá"),o("th",null,"Thành tiền"),o("th")])],-1)),So={key:0},xo=l(()=>o("td",{colspan:"7",class:"text-center"},"Không có dữ liệu",-1)),Co=[xo],Mo={class:"ma"},wo={class:"ten"},Do={class:"quantity"},Vo={class:"quantity"},Bo={class:"money"},To={class:"money"},Uo={class:"action"},$o=["onClick"],Eo=l(()=>o("i",{class:"fas fa-trash"},null,-1)),Io=[Eo],Yo={class:"modal-footer"},jo=["disabled"],qo={__name:"DonBanModal",props:{don_hang:Object,khach_hang_list:Object,san_pham_list:Object},setup(h){const i=h,t=T({id:"",ma:"",ngay:"",khach_hang_id:"",ghi_chu:"",loai:1,chi_tiet_don_hang:[]});let e=U({id:"",don_hang_id:i.don_hang.id,san_pham:{},so_luong:1,gia:0});E(()=>{var g;t.id=i.don_hang.id||"",t.ma=i.don_hang.ma||"",t.ngay=i.don_hang.ngay||O().format("YYYY-MM-DD"),t.khach_hang_id=((g=i.don_hang.khach_hang)==null?void 0:g.id)||"",t.ghi_chu=i.don_hang.ghi_chu||"",t.chi_tiet_don_hang=i.don_hang.chi_tiet_don_hang||[]});const w=()=>{i.don_hang.id||(t.ma="DH"+Date.now().toString().slice(-6)),t.post(route("donhang.store"),{onSuccess:()=>{p()},onError:()=>{console.log(t.errors)}})},p=()=>{$("#donhangmodal").modal("hide"),t.reset(),t.chi_tiet_don_hang=[],t.clearErrors()};function D(g){t.chi_tiet_don_hang=t.chi_tiet_don_hang.filter((a,n)=>n!==g)}function V(){M.isEmpty(e.value.san_pham)||e.value.so_luong!==0&&(t.chi_tiet_don_hang.push({id:"",don_hang_id:i.don_hang.id,san_pham:M.cloneDeep(e.value.san_pham),so_luong:e.value.so_luong,gia:e.value.gia,thanh_tien:e.value.gia*e.value.so_luong}),e.value={id:"",don_hang_id:i.don_hang.id,san_pham:{},so_luong:0,gia:0},$("#sanpham").val(null).trigger("change"))}return I(()=>{$("#sanpham").select2({placeholder:"Chọn sản phẩm"}).on("change",function(){e.value.san_pham=i.san_pham_list.data.find(g=>String(g.id)===$(this).val())}),$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"}).on("change",function(){t.khach_hang_id=$(this).val()})}),Y(()=>{$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"})}),(g,a)=>(d(),_("div",F,[o("div",H,[o("div",K,[o("div",L,[o("button",{type:"button",class:"close",onClick:m(p,["prevent"])},"×")]),o("form",{onSubmit:m(w,["prevent"])},[o("div",N,[r(o("input",{type:"hidden","onUpdate:modelValue":a[0]||(a[0]=n=>s(t).id=n),id:"id",class:"form-control"},null,512),[[u,s(t).id]]),o("div",A,[o("div",G,[h.don_hang.id?(d(),_("span",J,"Sửa đơn hàng")):(d(),_("span",P,"Thêm đơn hàng"))]),o("div",Q,[R,o("div",null,[r(o("input",{readonly:"",class:f([{"border-danger":s(t).errors.ma},"form-control"]),type:"text","onUpdate:modelValue":a[1]||(a[1]=n=>s(t).ma=n),id:"ma"},null,2),[[u,s(t).ma]])])]),o("div",W,[X,o("div",null,[r(o("input",{class:f([{"border-danger":s(t).errors.ngay},"form-control"]),type:"date","onUpdate:modelValue":a[2]||(a[2]=n=>s(t).ngay=n),id:"ngay"},null,2),[[u,s(t).ngay]])])]),o("div",Z,[oo,o("div",null,[r(o("select",{class:f([{"border-danger":s(t).errors.khach_hang_id},"form-control"]),"onUpdate:modelValue":a[3]||(a[3]=n=>s(t).khach_hang_id=n),id:"khach_hang_id"},[no,(d(!0),_(v,null,b(h.khach_hang_list,n=>(d(),_("option",{key:n.id,value:n.id},c(n.ten),9,to))),128))],2),[[C,s(t).khach_hang_id]])])]),o("div",so,[ao,o("div",null,[r(o("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=n=>s(t).ghi_chu=n),class:"form-control",id:"ghi_chu"},null,512),[[u,s(t).ghi_chu]])])])]),o("div",eo,[lo,o("div",io,[o("div",_o,[o("div",ho,[ro,r(o("select",{class:"form-control","onUpdate:modelValue":a[5]||(a[5]=n=>s(e).san_pham=n),id:"sanpham"},[(d(!0),_(v,null,b(h.san_pham_list.data,n=>(d(),_("option",{value:n.id},c(n.ten),9,co))),256))],512),[[C,s(e).san_pham]])])]),o("div",go,[o("div",uo,[mo,r(o("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=n=>s(e).so_luong=n),class:"form-control",id:"ghi_chu"},null,512),[[u,s(e).so_luong]])])]),o("div",po,[o("div",fo,[vo,r(o("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=n=>s(e).gia=n),class:"form-control",id:"gia"},null,512),[[u,s(e).gia]])])]),o("div",bo,[o("button",{onClick:a[8]||(a[8]=m(n=>V(),["prevent"])),class:"btn btn-primary form-control"},"Thêm")])]),o("table",yo,[ko,o("tbody",null,[s(t).chi_tiet_don_hang.length===0?(d(),_("tr",So,Co)):(d(!0),_(v,{key:1},b(s(t).chi_tiet_don_hang,(n,B)=>{var y,k,S,x;return d(),_("tr",{key:n.id},[o("td",Mo,c((y=n==null?void 0:n.san_pham)==null?void 0:y.ma),1),o("td",wo,c((k=n==null?void 0:n.san_pham)==null?void 0:k.ten),1),o("td",Do,c(n==null?void 0:n.so_luong),1),o("td",Vo,c((x=(S=n==null?void 0:n.san_pham)==null?void 0:S.don_vi_tinh)==null?void 0:x.ten),1),o("td",Bo,c(n==null?void 0:n.gia.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",To,c(n==null?void 0:n.thanh_tien.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Uo,[o("a",{class:"btn btn-danger btn-sm",onClick:m(Oo=>D(B),["prevent"])},Io,8,$o)])])}),128))])])])]),o("div",Yo,[o("button",{type:"submit",disabled:s(t).processing,class:"btn btn-primary"},"Lưu",8,jo),o("button",{type:"button",class:"btn btn-default",onClick:m(p,["prevent"])},"Hủy")])],32)])])]))}},Lo=z(qo,[["__scopeId","data-v-62fcf3bd"]]);export{Lo as default};
