import{T as U,h as B,z as E,q as I,A as Y,o as _,c as d,a as n,e as g,w as u,f as m,u as s,n as S,B as x,F as v,k as f,t as r,x as j,y as q}from"./app-1a80bf0b.js";import{l as C}from"./lodash-7b36f5c8.js";import{h as O}from"./moment-a9aaa855.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const l=c=>(j("data-v-80026336"),c=c(),q(),c),F={id:"donhangmodal",class:"modal fade",role:"dialog"},H={class:"modal-dialog modal-xl",role:"document"},L={class:"modal-content"},N={class:"modal-header"},A={class:"modal-body"},G={class:"form-group-container"},K={class:"form-group-title"},J={key:0,class:"txt-color mb-0 font-weight-bold"},P={key:1,class:"txt-color mb-0 font-weight-bold"},Q={class:"form-group"},R=l(()=>n("label",{for:"ma"},"Mã đơn",-1)),W={class:"form-group"},X=l(()=>n("label",{for:"nha_cung_cap_id"},"Nhà cung cấp",-1)),Z=l(()=>n("option",{value:""},"Chọn nhà cung cấp",-1)),nn=["value"],on={class:"form-group"},tn=l(()=>n("label",{for:"ghi_chu"},"Ghi chú",-1)),sn={class:"form-group-container mt-4"},an=l(()=>n("div",{class:"form-group-title"},[n("span",null,"Chi tiết đơn mua")],-1)),en={class:"row mb-3"},ln={class:"col-4"},_n={class:"form-record"},dn=l(()=>n("label",null,"Sản phẩm",-1)),cn=["value"],rn={class:"col-3"},hn={class:"form-record"},un=l(()=>n("label",{for:"name"},"Số lượng",-1)),gn={class:"col-3"},mn={class:"form-record"},pn=l(()=>n("label",{for:"name"},"Đơn giá",-1)),vn={class:"col-2"},fn={class:"table table-bordered table-responsive-md"},bn=l(()=>n("thead",null,[n("tr",null,[n("th",null,"Mã sản phẩm"),n("th",null,"Tên sản phẩm"),n("th",null,"Số lượng"),n("th",null,"ĐVT"),n("th",null,"Đơn giá"),n("th",null,"Thành tiền"),n("th")])],-1)),yn={key:0},kn=l(()=>n("td",{colspan:"7",class:"text-center"},"Không có dữ liệu",-1)),Mn=[kn],Sn={class:"ma"},xn={class:"ten"},Cn={class:"quantity"},wn={class:"quantity"},Dn={class:"money"},Tn={class:"money"},Vn={class:"action"},$n=["onClick"],Un=l(()=>n("i",{class:"fas fa-trash"},null,-1)),Bn=[Un],En={class:"modal-footer"},In=["disabled"],Yn={__name:"DonMuaModal",props:{don_hang:Object,nha_cung_cap_list:Object,san_pham_list:Object},setup(c){const i=c,t=U({id:"",ma:"",ngay:"",nha_cung_cap_id:"",ghi_chu:"",loai:0,chi_tiet_don_hang:[]});let e=B({id:"",don_hang_id:i.don_hang.id,san_pham:{},so_luong:1,gia:0});E(()=>{var h;t.id=i.don_hang.id||"",t.ma=i.don_hang.ma||"",t.ngay=i.don_hang.ngay||O().format("YYYY-MM-DD"),t.nha_cung_cap_id=((h=i.don_hang.nha_cung_cap)==null?void 0:h.id)||"",t.ghi_chu=i.don_hang.ghi_chu||"",t.chi_tiet_don_hang=i.don_hang.chi_tiet_don_hang||[]});const w=()=>{i.don_hang.id||(t.ma="DH"+Date.now().toString().slice(-6)),t.post(route("donhang.store"),{onSuccess:()=>{p()},onError:()=>{console.log(t.errors)}})},p=()=>{$("#donhangmodal").modal("hide"),t.reset(),t.chi_tiet_don_hang=[],t.clearErrors()};function D(h){t.chi_tiet_don_hang=t.chi_tiet_don_hang.filter((a,o)=>o!==h)}function T(){C.isEmpty(e.value.san_pham)||e.value.so_luong!==0&&(t.chi_tiet_don_hang.push({id:"",don_hang_id:i.don_hang.id,san_pham:C.cloneDeep(e.value.san_pham),so_luong:e.value.so_luong,gia:e.value.gia,thanh_tien:e.value.gia*e.value.so_luong}),e.value={id:"",don_hang_id:i.don_hang.id,san_pham:{},so_luong:0,gia:0},$("#sanpham").val(null).trigger("change"))}return I(()=>{$("#sanpham").select2({placeholder:"Chọn sản phẩm"}).on("change",function(){e.value.san_pham=i.san_pham_list.data.find(h=>String(h.id)===$(this).val())}),$("#nha_cung_cap_id").select2({placeholder:"Chọn nhà cung cấp",width:"100%"}).on("change",function(){t.nha_cung_cap_id=$(this).val()})}),Y(()=>{$("#nha_cung_cap_id").select2({placeholder:"Chọn nhà cung cấp",width:"100%"})}),(h,a)=>(_(),d("div",F,[n("div",H,[n("div",L,[n("div",N,[n("button",{type:"button",class:"close",onClick:g(p,["prevent"])},"×")]),n("form",{onSubmit:g(w,["prevent"])},[n("div",A,[u(n("input",{type:"hidden","onUpdate:modelValue":a[0]||(a[0]=o=>s(t).id=o),id:"id",class:"form-control"},null,512),[[m,s(t).id]]),n("div",G,[n("div",K,[c.don_hang.id?(_(),d("span",J,"Sửa đơn hàng")):(_(),d("span",P,"Thêm đơn hàng"))]),n("div",Q,[R,n("div",null,[u(n("input",{readonly:"",class:S([{"border-danger":s(t).errors.ma},"form-control"]),type:"text","onUpdate:modelValue":a[1]||(a[1]=o=>s(t).ma=o),id:"ma"},null,2),[[m,s(t).ma]])])]),n("div",W,[X,n("div",null,[u(n("select",{class:S([{"border-danger":s(t).errors.nha_cung_cap_id},"form-control"]),"onUpdate:modelValue":a[2]||(a[2]=o=>s(t).nha_cung_cap_id=o),id:"nha_cung_cap_id"},[Z,(_(!0),d(v,null,f(c.nha_cung_cap_list,o=>(_(),d("option",{key:o.id,value:o.id},r(o.ten),9,nn))),128))],2),[[x,s(t).nha_cung_cap_id]])])]),n("div",on,[tn,n("div",null,[u(n("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=o=>s(t).ghi_chu=o),class:"form-control",id:"ghi_chu"},null,512),[[m,s(t).ghi_chu]])])])]),n("div",sn,[an,n("div",en,[n("div",ln,[n("div",_n,[dn,u(n("select",{class:"form-control","onUpdate:modelValue":a[4]||(a[4]=o=>s(e).san_pham=o),id:"sanpham"},[(_(!0),d(v,null,f(c.san_pham_list.data,o=>(_(),d("option",{value:o.id},r(o.ten),9,cn))),256))],512),[[x,s(e).san_pham]])])]),n("div",rn,[n("div",hn,[un,u(n("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=o=>s(e).so_luong=o),class:"form-control",id:"ghi_chu"},null,512),[[m,s(e).so_luong]])])]),n("div",gn,[n("div",mn,[pn,u(n("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=o=>s(e).gia=o),class:"form-control",id:"gia"},null,512),[[m,s(e).gia]])])]),n("div",vn,[n("button",{onClick:a[7]||(a[7]=g(o=>T(),["prevent"])),class:"btn btn-primary form-control"},"Thêm")])]),n("table",fn,[bn,n("tbody",null,[s(t).chi_tiet_don_hang.length===0?(_(),d("tr",yn,Mn)):(_(!0),d(v,{key:1},f(s(t).chi_tiet_don_hang,(o,V)=>{var b,y,k,M;return _(),d("tr",{key:o.id},[n("td",Sn,r((b=o==null?void 0:o.san_pham)==null?void 0:b.ma),1),n("td",xn,r((y=o==null?void 0:o.san_pham)==null?void 0:y.ten),1),n("td",Cn,r(o==null?void 0:o.so_luong),1),n("td",wn,r((M=(k=o==null?void 0:o.san_pham)==null?void 0:k.don_vi_tinh)==null?void 0:M.ten),1),n("td",Dn,r(o==null?void 0:o.gia.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),n("td",Tn,r(o==null?void 0:o.thanh_tien.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),n("td",Vn,[n("a",{class:"btn btn-danger btn-sm",onClick:g(jn=>D(V),["prevent"])},Bn,8,$n)])])}),128))])])])]),n("div",En,[n("button",{type:"submit",disabled:s(t).processing,class:"btn btn-primary"},"Lưu",8,In),n("button",{type:"button",class:"btn btn-default",onClick:g(p,["prevent"])},"Hủy")])],32)])])]))}},Hn=z(Yn,[["__scopeId","data-v-80026336"]]);export{Hn as default};
