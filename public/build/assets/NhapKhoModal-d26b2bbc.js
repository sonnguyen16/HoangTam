import{T,h as N,z as B,q as E,A as K,o as l,c as d,a as o,e as m,w as r,f as p,u as s,n as g,B as b,F as v,k as f,t as c,x as j,y as O}from"./app-fd7f12dc.js";import{l as x}from"./lodash-417b527b.js";import{h as I}from"./moment-a9aaa855.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";const i=h=>(j("data-v-db5c189e"),h=h(),O(),h),q={id:"hoadonmodal",class:"modal fade",role:"dialog"},H={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content"},F={class:"modal-header"},L={class:"modal-body"},A={class:"form-group-container"},G={class:"form-group-title"},J={key:0,class:"txt-color mb-0 font-weight-bold"},P={key:1,class:"txt-color mb-0 font-weight-bold"},Q={class:"form-group"},R=i(()=>o("label",{for:"ma"},"Mã phiếu",-1)),W={class:"form-group"},X=i(()=>o("label",{for:"du_an_id"},"Dự án",-1)),Z=i(()=>o("option",{value:""},"Chọn dự án",-1)),oo=["value"],no={class:"form-group"},to=i(()=>o("label",{for:"ngay"},"Ngày",-1)),so={class:"form-group"},eo=i(()=>o("label",{for:"nha_cung_cap_id"},"Nhà cung cấp",-1)),ao=i(()=>o("option",{value:""},"Chọn nhà cung cấp",-1)),io=["value"],lo={class:"form-group"},_o=i(()=>o("label",{for:"kho_id"},"Kho",-1)),ho=i(()=>o("option",{value:""},"Chọn kho",-1)),ro=["value"],co={class:"form-group"},uo=i(()=>o("label",{for:"ghi_chu"},"Ghi chú",-1)),po={class:"form-group-container mt-4"},mo=i(()=>o("div",{class:"form-group-title"},[o("span",null,"Chi tiết phiếu nhập")],-1)),go={class:"row mb-3"},vo={class:"col-4"},fo={class:"form-record"},bo=i(()=>o("label",null,"Sản phẩm",-1)),yo=["value"],ko={class:"col-3"},Co={class:"form-record"},wo=i(()=>o("label",{for:"name"},"Số lượng",-1)),So={class:"col-3"},$o={class:"form-record"},xo=i(()=>o("label",{for:"name"},"Đơn giá",-1)),Mo={class:"col-2"},Vo={class:"table table-bordered table-responsive-md"},Uo=i(()=>o("thead",null,[o("tr",null,[o("th",null,"Mã sản phẩm"),o("th",null,"Tên sản phẩm"),o("th",null,"Số lượng"),o("th",null,"ĐVT"),o("th",null,"Đơn giá"),o("th",null,"Thành tiền"),o("th")])],-1)),Do={key:0},To=i(()=>o("td",{colspan:"7",class:"text-center"},"Không có dữ liệu",-1)),No=[To],Bo={class:"ma"},Eo={class:"ten"},Ko={class:"quantity"},jo={class:"quantity"},Oo={class:"money"},Io={class:"money"},Yo={class:"action"},qo=["onClick"],Ho=i(()=>o("i",{class:"fas fa-trash"},null,-1)),zo=[Ho],Fo={class:"modal-footer"},Lo=["disabled"],Ao={__name:"NhapKhoModal",props:{hoa_don:Object,nha_cung_cap_list:Object,kho_list:Object,san_pham_list:Object,du_an_list:Object},setup(h){const _=h,t=T({id:"",ma:"",ngay:"",nha_cung_cap_id:"",kho_id:"",ghi_chu:"",loai:0,chi_tiet_hoa_don:[],du_an_id:""});let a=N({id:"",hoa_don_id:_.hoa_don.id,san_pham:{},so_luong:1,gia:0});B(()=>{var u;t.id=_.hoa_don.id||"",t.ma=_.hoa_don.ma||"",t.ngay=_.hoa_don.ngay||I().format("YYYY-MM-DD"),t.nha_cung_cap_id=((u=_.hoa_don.nha_cung_cap)==null?void 0:u.id)||"",t.kho_id=_.hoa_don.kho.id||"",t.ghi_chu=_.hoa_don.ghi_chu||"",t.chi_tiet_hoa_don=_.hoa_don.chi_tiet_hoa_don||[],t.du_an_id=_.hoa_don.du_an_id||""});const M=()=>{_.hoa_don.id||(t.ma="NK"+Date.now().toString().slice(-6)),t.post(route("hoadon.store"),{onSuccess:()=>{y()},onError:()=>{console.log(t.errors)}})},y=()=>{$("#hoadonmodal").modal("hide"),t.reset(),t.chi_tiet_hoa_don=[],t.clearErrors()};function V(u){t.chi_tiet_hoa_don=t.chi_tiet_hoa_don.filter((e,n)=>n!==u)}function U(){x.isEmpty(a.value.san_pham)||a.value.so_luong!==0&&(t.chi_tiet_hoa_don.push({id:"",hoa_don_id:_.hoa_don.id,san_pham:x.cloneDeep(a.value.san_pham),so_luong:a.value.so_luong,gia:a.value.gia,thanh_tien:a.value.gia*a.value.so_luong}),a.value={id:"",hoa_don_id:_.hoa_don.id,san_pham:{},so_luong:1,gia:0},$("#sanpham").val(null).trigger("change"))}return E(()=>{$("#sanpham").select2({placeholder:"Chọn sản phẩm"}).on("change",function(){var u;a.value.san_pham=_.san_pham_list.data.find(e=>String(e.id)===$(this).val()),a.value.gia=(u=a.value.san_pham)==null?void 0:u.gia_nhap}),$("#kho_id").select2({placeholder:"Chọn kho",width:"100%"}).on("change",function(){t.kho_id=$(this).val()}),$("#nha_cung_cap_id").select2({placeholder:"Chọn nhà cung cấp",width:"100%"}).on("change",function(){t.nha_cung_cap_id=$(this).val()}),$("#du_an_id").select2({placeholder:"Chọn dự án",width:"100%"}).on("change",function(){t.du_an_id=$(this).val()})}),K(()=>{$("#kho_id").select2({placeholder:"Chọn kho",width:"100%"}),$("#nha_cung_cap_id").select2({placeholder:"Chọn nhà cung cấp",width:"100%"}),$("#du_an_id").select2({placeholder:"Chọn dự án",width:"100%"})}),(u,e)=>(l(),d("div",q,[o("div",H,[o("div",z,[o("div",F,[o("button",{type:"button",class:"close",onClick:m(y,["prevent"])},"×")]),o("form",{onSubmit:m(M,["prevent"])},[o("div",L,[r(o("input",{type:"hidden","onUpdate:modelValue":e[0]||(e[0]=n=>s(t).id=n),id:"id",class:"form-control"},null,512),[[p,s(t).id]]),o("div",A,[o("div",G,[h.hoa_don.id?(l(),d("span",J,"Sửa phiếu nhập kho")):(l(),d("span",P,"Thêm phiếu nhập kho"))]),o("div",Q,[R,o("div",null,[r(o("input",{readonly:"",class:g([{"border-danger":s(t).errors.ma},"form-control"]),type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>s(t).ma=n),id:"ma"},null,2),[[p,s(t).ma]])])]),o("div",W,[X,o("div",null,[r(o("select",{class:g([{"border-danger":s(t).errors.du_an_id},"form-control"]),"onUpdate:modelValue":e[2]||(e[2]=n=>s(t).du_an_id=n),id:"du_an_id"},[Z,(l(!0),d(v,null,f(h.du_an_list,n=>(l(),d("option",{key:n.id,value:n.id},c(n.ten),9,oo))),128))],2),[[b,s(t).du_an_id]])])]),o("div",no,[to,o("div",null,[r(o("input",{class:g([{"border-danger":s(t).errors.date},"form-control"]),type:"date","onUpdate:modelValue":e[3]||(e[3]=n=>s(t).ngay=n),id:"ngay"},null,2),[[p,s(t).ngay]])])]),o("div",so,[eo,o("div",null,[r(o("select",{class:g([{"border-danger":s(t).errors.nha_cung_cap_id},"form-control"]),"onUpdate:modelValue":e[4]||(e[4]=n=>s(t).nha_cung_cap_id=n),id:"nha_cung_cap_id"},[ao,(l(!0),d(v,null,f(h.nha_cung_cap_list,n=>(l(),d("option",{key:n.id,value:n.id},c(n.ten),9,io))),128))],2),[[b,s(t).nha_cung_cap_id]])])]),o("div",lo,[_o,o("div",null,[r(o("select",{class:g([["form-control",{"border-danger":s(t).errors.kho_id}],""]),"onUpdate:modelValue":e[5]||(e[5]=n=>s(t).kho_id=n),id:"kho_id"},[ho,(l(!0),d(v,null,f(h.kho_list,n=>(l(),d("option",{key:n.id,value:n.id},c(n.ten),9,ro))),128))],2),[[b,s(t).kho_id]])])]),o("div",co,[uo,o("div",null,[r(o("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=n=>s(t).ghi_chu=n),class:"form-control",id:"ghi_chu"},null,512),[[p,s(t).ghi_chu]])])])]),o("div",po,[mo,o("div",go,[o("div",vo,[o("div",fo,[bo,r(o("select",{class:"form-control","onUpdate:modelValue":e[7]||(e[7]=n=>s(a).san_pham=n),id:"sanpham"},[(l(!0),d(v,null,f(h.san_pham_list.data,n=>(l(),d("option",{value:n.id},c(n.ten),9,yo))),256))],512),[[b,s(a).san_pham]])])]),o("div",ko,[o("div",Co,[wo,r(o("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=n=>s(a).so_luong=n),class:"form-control",id:"ghi_chu"},null,512),[[p,s(a).so_luong]])])]),o("div",So,[o("div",$o,[xo,r(o("input",{type:"number","onUpdate:modelValue":e[9]||(e[9]=n=>s(a).gia=n),class:"form-control",id:"gia"},null,512),[[p,s(a).gia]])])]),o("div",Mo,[o("button",{onClick:e[10]||(e[10]=m(n=>U(),["prevent"])),class:"btn btn-primary form-control"},"Thêm")])]),o("table",Vo,[Uo,o("tbody",null,[s(t).chi_tiet_hoa_don.length===0?(l(),d("tr",Do,No)):(l(!0),d(v,{key:1},f(s(t).chi_tiet_hoa_don,(n,D)=>{var k,C,w,S;return l(),d("tr",{key:n.id},[o("td",Bo,c((k=n==null?void 0:n.san_pham)==null?void 0:k.ma),1),o("td",Eo,c((C=n==null?void 0:n.san_pham)==null?void 0:C.ten),1),o("td",Ko,c(n==null?void 0:n.so_luong),1),o("td",jo,c((S=(w=n==null?void 0:n.san_pham)==null?void 0:w.don_vi_tinh)==null?void 0:S.ten),1),o("td",Oo,c(n==null?void 0:n.gia.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Io,c(n==null?void 0:n.thanh_tien.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Yo,[o("a",{class:"btn btn-danger btn-sm",onClick:m(Go=>V(D),["prevent"])},zo,8,qo)])])}),128))])])])]),o("div",Fo,[o("button",{type:"submit",disabled:s(t).processing,class:"btn btn-primary"},"Lưu",8,Lo),o("button",{type:"button",class:"btn btn-default",onClick:m(y,["prevent"])},"Hủy")])],32)])])]))}},Wo=Y(Ao,[["__scopeId","data-v-db5c189e"]]);export{Wo as default};
