import{T as j,h as B,z as E,q as O,A as H,o as d,c as _,a as o,e as g,w as c,f as p,u as a,n as f,B as y,F as v,k as b,g as I,t as u,x as X,y as Y}from"./app-c8d499e9.js";import{l as x}from"./lodash-64e526cc.js";import q from"./ChonDonHangModal-ee09277f.js";import{h as N}from"./moment-a9aaa855.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import"./Pagination-c4204370.js";const i=h=>(X("data-v-0c1b049f"),h=h(),Y(),h),A={id:"hoadonmodal",class:"modal fade",role:"dialog"},F={class:"modal-dialog modal-xl",role:"document"},L={class:"modal-content"},G={class:"modal-header"},J={class:"modal-body"},P={class:"form-group-container"},Q={class:"form-group-title"},R={key:0,class:"txt-color mb-0 font-weight-bold"},W={key:1,class:"txt-color mb-0 font-weight-bold"},Z={class:"form-group"},oo=i(()=>o("label",{for:"ma"},"Mã phiếu",-1)),no={class:"form-group"},to=i(()=>o("label",{for:"du_an_id"},"Dự án",-1)),ao=i(()=>o("option",{value:""},"Chọn dự án",-1)),so=["value"],eo={class:"form-group"},io=i(()=>o("label",{for:"ngay"},"Ngày",-1)),lo={class:"form-group"},_o=i(()=>o("label",{for:"name"},"Khách hàng",-1)),ho=i(()=>o("option",{value:""},"Chọn khách hàng",-1)),ro=["value"],co={class:"form-group"},uo=i(()=>o("label",{for:"kho_id"},"Kho",-1)),mo=i(()=>o("option",{value:""},"Chọn kho",-1)),go=["value"],po={class:"form-group"},vo=i(()=>o("label",{for:"ghi_chu"},"Ghi chú",-1)),fo={class:"form-group-container mt-4"},bo=i(()=>o("div",{class:"form-group-title"},[o("span",null,"Chi tiết phiếu xuất")],-1)),ko={class:"row mb-3"},yo={class:"col-2"},Co={class:"col-3"},$o={class:"form-record"},xo=i(()=>o("label",null,"Sản phẩm",-1)),wo=i(()=>o("option",{value:""},"Chọn sản phẩm",-1)),So=["value"],Vo={class:"col-3"},Do={class:"form-record"},Mo=i(()=>o("label",{for:"name"},"Số lượng",-1)),Uo={class:"col-3"},To={class:"form-record"},Ko=i(()=>o("label",{for:"name"},"Đơn giá",-1)),jo={class:"col"},Bo={class:"table table-bordered table-responsive-md"},Eo=i(()=>o("thead",null,[o("tr",null,[o("th",null,"Mã sản phẩm"),o("th",null,"Tên sản phẩm"),o("th",null,"Số lượng"),o("th",null,"ĐVT"),o("th",null,"Đơn giá"),o("th",null,"Thành tiền"),o("th")])],-1)),Oo={key:0},Ho=i(()=>o("td",{colspan:"7",class:"text-center"},"Không có dữ liệu",-1)),Io=[Ho],Xo={class:"ma"},Yo={class:"ten"},qo={class:"quantity"},No={class:"quantity"},zo={class:"money"},Ao={class:"money"},Fo={class:"action"},Lo=["onClick"],Go=i(()=>o("i",{class:"fas fa-trash"},null,-1)),Jo=[Go],Po={class:"modal-footer"},Qo=["disabled"],Ro={__name:"XuatKhoModal",props:{hoa_don:Object,khach_hang_list:Object,kho_list:Object,san_pham_list:Object,don_hang_ban_list:Object,du_an_list:Object},setup(h){const l=h,t=j({id:"",ma:"",ngay:"",khach_hang_id:"",kho_id:"",ghi_chu:"",loai:1,du_an_id:"",chi_tiet_hoa_don:[]});let e=B({id:"",hoa_don_id:l.hoa_don.id,san_pham:{},so_luong:1,gia:0});E(()=>{var r;t.id=l.hoa_don.id||"",t.ma=l.hoa_don.ma||"",t.ngay=l.hoa_don.ngay||N().format("YYYY-MM-DD"),t.khach_hang_id=((r=l.hoa_don.khach_hang)==null?void 0:r.id)||"",t.kho_id=l.hoa_don.kho.id||"",t.ghi_chu=l.hoa_don.ghi_chu||"",t.du_an_id=l.hoa_don.du_an_id||"",t.chi_tiet_hoa_don=l.hoa_don.chi_tiet_hoa_don||[]});const M=()=>{l.hoa_don.id||(t.ma="XK"+Date.now().toString().slice(-6)),t.post(route("hoadon.store"),{onSuccess:()=>{C()},onError:r=>{console.log(r)}})},C=()=>{$("#hoadonmodal").modal("hide"),t.reset(),t.chi_tiet_hoa_don=[],t.clearErrors(),$("#sanpham").val(null).trigger("change"),$("#donhang").val(null).trigger("change")};function U(r){t.chi_tiet_hoa_don=t.chi_tiet_hoa_don.filter((s,k)=>k!==r)}function T(){x.isEmpty(e.value.san_pham)||e.value.so_luong!==0&&(t.chi_tiet_hoa_don.push({id:"",hoa_don_id:l.hoa_don.id,san_pham:x.cloneDeep(e.value.san_pham),so_luong:e.value.so_luong,gia:e.value.gia,thanh_tien:e.value.gia*e.value.so_luong}),e.value={id:"",hoa_don_id:l.hoa_don.id,san_pham:{},so_luong:1,gia:0},$("#sanpham").val(null).trigger("change"))}O(()=>{$("#sanpham").select2({placeholder:"Chọn sản phẩm"}).on("change",function(){var r;e.value.san_pham=l.san_pham_list.data.find(s=>String(s.id)===$(this).val()),e.value.gia=(r=e.value.san_pham)==null?void 0:r.gia_ban}),$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"}).on("change",function(){t.khach_hang_id=$(this).val()}),$("#kho_id").select2({placeholder:"Chọn kho",width:"100%"}).on("change",function(){t.kho_id=$(this).val()}),$("#du_an_id").select2({placeholder:"Chọn dự án",width:"100%"}).on("change",function(){t.du_an_id=$(this).val()})}),H(()=>{$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"}),$("#kho_id").select2({placeholder:"Chọn kho",width:"100%"}),$("#du_an_id").select2({placeholder:"Chọn dự án",width:"100%"})});function K(){$("#chondonhangmodal").modal("show")}return(r,s)=>{var k;return d(),_(v,null,[o("div",A,[o("div",F,[o("div",L,[o("div",G,[o("button",{type:"button",class:"close",onClick:g(C,["prevent"])},"×")]),o("form",{onSubmit:g(M,["prevent"])},[o("div",J,[c(o("input",{type:"hidden","onUpdate:modelValue":s[0]||(s[0]=n=>a(t).id=n),id:"id",class:"form-control"},null,512),[[p,a(t).id]]),o("div",P,[o("div",Q,[h.hoa_don.id?(d(),_("span",R,"Sửa phiếu xuất kho")):(d(),_("span",W,"Thêm phiếu xuất kho"))]),o("div",Z,[oo,o("div",null,[c(o("input",{readonly:"",class:f([{"border-danger":a(t).errors.ma},"form-control"]),type:"text","onUpdate:modelValue":s[1]||(s[1]=n=>a(t).ma=n),id:"ma"},null,2),[[p,a(t).ma]])])]),o("div",no,[to,o("div",null,[c(o("select",{class:f([{"border-danger":a(t).errors.du_an_id},"form-control"]),"onUpdate:modelValue":s[2]||(s[2]=n=>a(t).du_an_id=n),id:"du_an_id"},[ao,(d(!0),_(v,null,b(h.du_an_list,n=>(d(),_("option",{key:n.id,value:n.id},u(n.ten),9,so))),128))],2),[[y,a(t).du_an_id]])])]),o("div",eo,[io,o("div",null,[c(o("input",{class:f([{"border-danger":a(t).errors.date},"form-control"]),type:"date","onUpdate:modelValue":s[3]||(s[3]=n=>a(t).ngay=n),id:"ngay"},null,2),[[p,a(t).ngay]])])]),o("div",lo,[_o,o("div",null,[c(o("select",{class:f([{"border-danger":a(t).errors.khach_hang_id},"form-control"]),"onUpdate:modelValue":s[4]||(s[4]=n=>a(t).khach_hang_id=n),id:"khach_hang_id"},[ho,(d(!0),_(v,null,b(h.khach_hang_list,n=>(d(),_("option",{key:n.id,value:n.id},u(n.ten),9,ro))),128))],2),[[y,a(t).khach_hang_id]])])]),o("div",co,[uo,o("div",null,[c(o("select",{class:f([{"border-danger":a(t).errors.kho_id},"form-control"]),"onUpdate:modelValue":s[5]||(s[5]=n=>a(t).kho_id=n),id:"kho_id"},[mo,(d(!0),_(v,null,b(h.kho_list,n=>(d(),_("option",{key:n.id,value:n.id},u(n.ten),9,go))),128))],2),[[y,a(t).kho_id]])])]),o("div",po,[vo,o("div",null,[c(o("input",{type:"text","onUpdate:modelValue":s[6]||(s[6]=n=>a(t).ghi_chu=n),class:"form-control",id:"ghi_chu"},null,512),[[p,a(t).ghi_chu]])])])]),o("div",fo,[bo,o("div",ko,[o("div",yo,[o("button",{onClick:g(K,["prevent"]),class:"btn form-control text-white"}," Chọn đơn hàng ")]),o("div",Co,[o("div",$o,[xo,c(o("select",{class:"form-control","onUpdate:modelValue":s[7]||(s[7]=n=>a(e).san_pham=n),id:"sanpham"},[wo,(d(!0),_(v,null,b(h.san_pham_list.data,n=>(d(),_("option",{value:n.id},u(n.ten),9,So))),256))],512),[[y,a(e).san_pham]])])]),o("div",Vo,[o("div",Do,[Mo,c(o("input",{type:"number","onUpdate:modelValue":s[8]||(s[8]=n=>a(e).so_luong=n),class:"form-control",id:"ghi_chu"},null,512),[[p,a(e).so_luong]])])]),o("div",Uo,[o("div",To,[Ko,c(o("input",{type:"number","onUpdate:modelValue":s[9]||(s[9]=n=>a(e).gia=n),class:"form-control",id:"gia"},null,512),[[p,a(e).gia]])])]),o("div",jo,[o("button",{onClick:s[10]||(s[10]=g(n=>T(),["prevent"])),class:"btn btn-primary form-control"},"Thêm")])]),o("table",Bo,[Eo,o("tbody",null,[((k=a(t).chi_tiet_hoa_don)==null?void 0:k.length)===0?(d(),_("tr",Oo,Io)):(d(!0),_(v,{key:1},b(a(t).chi_tiet_hoa_don,(n,m)=>{var w,S,V,D;return d(),_("tr",{key:n.id},[o("td",Xo,u((w=n==null?void 0:n.san_pham)==null?void 0:w.ma),1),o("td",Yo,u((S=n==null?void 0:n.san_pham)==null?void 0:S.ten),1),o("td",qo,u(n==null?void 0:n.so_luong),1),o("td",No,u((D=(V=n==null?void 0:n.san_pham)==null?void 0:V.don_vi_tinh)==null?void 0:D.ten),1),o("td",zo,u(n==null?void 0:n.gia.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Ao,u(n==null?void 0:n.thanh_tien.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Fo,[o("a",{class:"btn btn-danger btn-sm",onClick:g(Wo=>U(m),["prevent"])},Jo,8,Lo)])])}),128))])])])]),o("div",Po,[o("button",{type:"submit",disabled:a(t).processing,class:"btn btn-primary"},"Lưu",8,Qo),o("button",{type:"button",class:"btn btn-default",onClick:g(C,["prevent"])},"Hủy")])],32)])])]),I(q,{don_hang_ban_list:h.don_hang_ban_list,onAddChiTietDonHang:s[11]||(s[11]=n=>a(t).chi_tiet_hoa_don.push(...n.map(m=>({id:"",hoa_don_id:l.hoa_don.id,san_pham:a(x.cloneDeep)(m.san_pham),so_luong:m.so_luong,gia:m.gia,thanh_tien:m.gia*m.so_luong}))))},null,8,["don_hang_ban_list"])],64)}}},en=z(Ro,[["__scopeId","data-v-0c1b049f"]]);export{en as default};
