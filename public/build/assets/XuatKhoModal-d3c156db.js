import{T as K,h as j,z as B,q as E,A as H,o as d,c as _,a as o,e as g,w as c,f as p,u as a,n as f,B as y,F as v,k as b,g as I,t as u,x as X,y as Y,O as q}from"./app-4c6714ee.js";import{l as C}from"./lodash-994b604c.js";import N from"./ChonDonHangModal-598c221a.js";import{h as z}from"./moment-a9aaa855.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";import"./Pagination-95128e28.js";const i=h=>(X("data-v-ea5dc531"),h=h(),Y(),h),F={id:"hoadonmodal",class:"modal fade",role:"dialog"},L={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content"},J={class:"modal-header"},P={class:"modal-body"},Q={class:"form-group-container"},R={class:"form-group-title"},W={key:0,class:"txt-color mb-0 font-weight-bold"},Z={key:1,class:"txt-color mb-0 font-weight-bold"},oo={class:"form-group"},no=i(()=>o("label",{for:"ma"},"Mã phiếu",-1)),to={class:"form-group"},ao=i(()=>o("label",{for:"du_an_id"},"Dự án",-1)),so=i(()=>o("option",{value:""},"Chọn dự án",-1)),eo=["value"],io={class:"form-group"},lo=i(()=>o("label",{for:"ngay"},"Ngày",-1)),_o={class:"form-group"},ho=i(()=>o("label",{for:"name"},"Khách hàng",-1)),ro=i(()=>o("option",{value:""},"Chọn khách hàng",-1)),co=["value"],uo={class:"form-group"},mo=i(()=>o("label",{for:"kho_id"},"Kho",-1)),go=i(()=>o("option",{value:""},"Chọn kho",-1)),po=["value"],vo={class:"form-group"},fo=i(()=>o("label",{for:"ghi_chu"},"Ghi chú",-1)),bo={class:"form-group-container mt-4"},ko=i(()=>o("div",{class:"form-group-title"},[o("span",null,"Chi tiết phiếu xuất")],-1)),yo={class:"row mb-3"},Co={class:"col-2"},xo={class:"col-3"},$o={class:"form-record"},wo=i(()=>o("label",null,"Sản phẩm",-1)),So=i(()=>o("option",{value:""},"Chọn sản phẩm",-1)),Vo=["value"],Do={class:"col-3"},Mo={class:"form-record"},Uo=i(()=>o("label",{for:"name"},"Số lượng",-1)),To={class:"col-3"},Oo={class:"form-record"},Ko=i(()=>o("label",{for:"name"},"Đơn giá",-1)),jo={class:"col"},Bo={class:"table table-bordered table-responsive-md"},Eo=i(()=>o("thead",null,[o("tr",null,[o("th",null,"Mã sản phẩm"),o("th",null,"Tên sản phẩm"),o("th",null,"Số lượng"),o("th",null,"ĐVT"),o("th",null,"Đơn giá"),o("th",null,"Thành tiền"),o("th")])],-1)),Ho={key:0},Io=i(()=>o("td",{colspan:"7",class:"text-center"},"Không có dữ liệu",-1)),Xo=[Io],Yo={class:"ma"},qo={class:"ten"},No={class:"quantity"},zo={class:"quantity"},Ao={class:"money"},Fo={class:"money"},Lo={class:"action"},Go=["onClick"],Jo=i(()=>o("i",{class:"fas fa-trash"},null,-1)),Po=[Jo],Qo={class:"modal-footer"},Ro=["disabled"],Wo={__name:"XuatKhoModal",props:{hoa_don:Object,khach_hang_list:Object,kho_list:Object,san_pham_list:Object,don_hang_ban_list:Object,du_an_list:Object},setup(h){const l=h,t=K({id:"",ma:"",ngay:"",khach_hang_id:"",kho_id:"",ghi_chu:"",loai:1,du_an_id:"",chi_tiet_hoa_don:[]});let e=j({id:"",hoa_don_id:l.hoa_don.id,san_pham:{},so_luong:1,gia:0});B(()=>{var r;t.id=l.hoa_don.id||"",t.ma=l.hoa_don.ma||"",t.ngay=l.hoa_don.ngay||z().format("YYYY-MM-DD"),t.khach_hang_id=((r=l.hoa_don.khach_hang)==null?void 0:r.id)||"",t.kho_id=l.hoa_don.kho.id||"",t.ghi_chu=l.hoa_don.ghi_chu||"",t.du_an_id=l.hoa_don.du_an_id||"",t.chi_tiet_hoa_don=l.hoa_don.chi_tiet_hoa_don||[]});const M=()=>{l.hoa_don.id||(t.ma="XK"+Date.now().toString().slice(-6)),t.post(route("hoadon.store"),{onSuccess:()=>{$("#hoadonmodal").modal("hide"),q.visit(route("baocaonhapxuat.index",{loai:"xuat"}))},onError:r=>{console.log(r)}})},x=()=>{$("#hoadonmodal").modal("hide"),t.reset(),t.chi_tiet_hoa_don=[],t.clearErrors(),$("#sanpham").val(null).trigger("change"),$("#donhang").val(null).trigger("change")};function U(r){t.chi_tiet_hoa_don=t.chi_tiet_hoa_don.filter((s,k)=>k!==r)}function T(){C.isEmpty(e.value.san_pham)||e.value.so_luong!==0&&(t.chi_tiet_hoa_don.push({id:"",hoa_don_id:l.hoa_don.id,san_pham:C.cloneDeep(e.value.san_pham),so_luong:e.value.so_luong,gia:e.value.gia,thanh_tien:e.value.gia*e.value.so_luong}),e.value={id:"",hoa_don_id:l.hoa_don.id,san_pham:{},so_luong:1,gia:0},$("#sanpham").val(null).trigger("change"))}E(()=>{$("#sanpham").select2({placeholder:"Chọn sản phẩm"}).on("change",function(){var r;e.value.san_pham=l.san_pham_list.data.find(s=>String(s.id)===$(this).val()),e.value.gia=(r=e.value.san_pham)==null?void 0:r.gia_ban}),$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"}).on("change",function(){t.khach_hang_id=$(this).val()}),$("#kho_id").select2({placeholder:"Chọn kho",width:"100%"}).on("change",function(){t.kho_id=$(this).val()}),$("#du_an_id").select2({placeholder:"Chọn dự án",width:"100%"}).on("change",function(){t.du_an_id=$(this).val()})}),H(()=>{$("#khach_hang_id").select2({placeholder:"Chọn khách hàng",width:"100%"}),$("#kho_id").select2({placeholder:"Chọn kho",width:"100%"}),$("#du_an_id").select2({placeholder:"Chọn dự án",width:"100%"})});function O(){$("#chondonhangmodal").modal("show")}return(r,s)=>{var k;return d(),_(v,null,[o("div",F,[o("div",L,[o("div",G,[o("div",J,[o("button",{type:"button",class:"close",onClick:g(x,["prevent"])},"×")]),o("form",{onSubmit:g(M,["prevent"])},[o("div",P,[c(o("input",{type:"hidden","onUpdate:modelValue":s[0]||(s[0]=n=>a(t).id=n),id:"id",class:"form-control"},null,512),[[p,a(t).id]]),o("div",Q,[o("div",R,[h.hoa_don.id?(d(),_("span",W,"Sửa phiếu xuất kho")):(d(),_("span",Z,"Thêm phiếu xuất kho"))]),o("div",oo,[no,o("div",null,[c(o("input",{readonly:"",class:f([{"border-danger":a(t).errors.ma},"form-control"]),type:"text","onUpdate:modelValue":s[1]||(s[1]=n=>a(t).ma=n),id:"ma"},null,2),[[p,a(t).ma]])])]),o("div",to,[ao,o("div",null,[c(o("select",{class:f([{"border-danger":a(t).errors.du_an_id},"form-control"]),"onUpdate:modelValue":s[2]||(s[2]=n=>a(t).du_an_id=n),id:"du_an_id"},[so,(d(!0),_(v,null,b(h.du_an_list,n=>(d(),_("option",{key:n.id,value:n.id},u(n.ten),9,eo))),128))],2),[[y,a(t).du_an_id]])])]),o("div",io,[lo,o("div",null,[c(o("input",{class:f([{"border-danger":a(t).errors.date},"form-control"]),type:"date","onUpdate:modelValue":s[3]||(s[3]=n=>a(t).ngay=n),id:"ngay"},null,2),[[p,a(t).ngay]])])]),o("div",_o,[ho,o("div",null,[c(o("select",{class:f([{"border-danger":a(t).errors.khach_hang_id},"form-control"]),"onUpdate:modelValue":s[4]||(s[4]=n=>a(t).khach_hang_id=n),id:"khach_hang_id"},[ro,(d(!0),_(v,null,b(h.khach_hang_list,n=>(d(),_("option",{key:n.id,value:n.id},u(n.ten),9,co))),128))],2),[[y,a(t).khach_hang_id]])])]),o("div",uo,[mo,o("div",null,[c(o("select",{class:f([{"border-danger":a(t).errors.kho_id},"form-control"]),"onUpdate:modelValue":s[5]||(s[5]=n=>a(t).kho_id=n),id:"kho_id"},[go,(d(!0),_(v,null,b(h.kho_list,n=>(d(),_("option",{key:n.id,value:n.id},u(n.ten),9,po))),128))],2),[[y,a(t).kho_id]])])]),o("div",vo,[fo,o("div",null,[c(o("input",{type:"text","onUpdate:modelValue":s[6]||(s[6]=n=>a(t).ghi_chu=n),class:"form-control",id:"ghi_chu"},null,512),[[p,a(t).ghi_chu]])])])]),o("div",bo,[ko,o("div",yo,[o("div",Co,[o("button",{onClick:g(O,["prevent"]),class:"btn form-control text-white"}," Chọn đơn hàng ")]),o("div",xo,[o("div",$o,[wo,c(o("select",{class:"form-control","onUpdate:modelValue":s[7]||(s[7]=n=>a(e).san_pham=n),id:"sanpham"},[So,(d(!0),_(v,null,b(h.san_pham_list.data,n=>(d(),_("option",{value:n.id},u(n.ten),9,Vo))),256))],512),[[y,a(e).san_pham]])])]),o("div",Do,[o("div",Mo,[Uo,c(o("input",{type:"number","onUpdate:modelValue":s[8]||(s[8]=n=>a(e).so_luong=n),class:"form-control",id:"ghi_chu"},null,512),[[p,a(e).so_luong]])])]),o("div",To,[o("div",Oo,[Ko,c(o("input",{type:"number","onUpdate:modelValue":s[9]||(s[9]=n=>a(e).gia=n),class:"form-control",id:"gia"},null,512),[[p,a(e).gia]])])]),o("div",jo,[o("button",{onClick:s[10]||(s[10]=g(n=>T(),["prevent"])),class:"btn btn-primary form-control"},"Thêm")])]),o("table",Bo,[Eo,o("tbody",null,[((k=a(t).chi_tiet_hoa_don)==null?void 0:k.length)===0?(d(),_("tr",Ho,Xo)):(d(!0),_(v,{key:1},b(a(t).chi_tiet_hoa_don,(n,m)=>{var w,S,V,D;return d(),_("tr",{key:n.id},[o("td",Yo,u((w=n==null?void 0:n.san_pham)==null?void 0:w.ma),1),o("td",qo,u((S=n==null?void 0:n.san_pham)==null?void 0:S.ten),1),o("td",No,u(n==null?void 0:n.so_luong),1),o("td",zo,u((D=(V=n==null?void 0:n.san_pham)==null?void 0:V.don_vi_tinh)==null?void 0:D.ten),1),o("td",Ao,u(n==null?void 0:n.gia.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Fo,u(n==null?void 0:n.thanh_tien.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),1),o("td",Lo,[o("a",{class:"btn btn-danger btn-sm",onClick:g(Zo=>U(m),["prevent"])},Po,8,Go)])])}),128))])])])]),o("div",Qo,[o("button",{type:"submit",disabled:a(t).processing,class:"btn btn-primary"},"Lưu",8,Ro),o("button",{type:"button",class:"btn btn-default",onClick:g(x,["prevent"])},"Hủy")])],32)])])]),I(N,{don_hang_ban_list:h.don_hang_ban_list,onAddChiTietDonHang:s[11]||(s[11]=n=>a(t).chi_tiet_hoa_don.push(...n.map(m=>({id:"",hoa_don_id:l.hoa_don.id,san_pham:a(C.cloneDeep)(m.san_pham),so_luong:m.so_luong,gia:m.gia,thanh_tien:m.gia*m.so_luong}))))},null,8,["don_hang_ban_list"])],64)}}},ln=A(Wo,[["__scopeId","data-v-ea5dc531"]]);export{ln as default};
